<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NSU CGPA Calculator</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:20px;
}
.container{
  max-width:1000px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:8px;
}
button{
  padding:6px 12px;
  margin:4px 2px;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}
.sem-box{
  border:1px solid #ddd;
  padding:12px;
  margin-top:15px;
}
.delete-btn{
  background:#e74c3c;
  color:#fff;
  border:none;
}
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
}
.modal-content{
  background:#fff;
  width:360px;
  margin:80px auto;
  padding:20px;
  border-radius:6px;
}
input,select{
  width:100%;
  padding:6px;
  margin-bottom:8px;
}
</style>
</head>

<body>

<div class="container">
<h2>NSU CGPA Calculator</h2>

<button onclick="addSemester()">➕ Add Semester</button>
<button onclick="addPreviousCGPA()">➕ Add Previous CGPA</button>

<h3>Total CGPA: <span id="totalCGPA">0.00</span></h3>

<div id="semesters"></div>
</div>

<!-- COURSE MODAL -->
<div class="modal" id="courseModal">
  <div class="modal-content">
    <h3>Add Course</h3>

    <input id="cCode" placeholder="Course Code">
    <input id="fCode" placeholder="Faculty Code">
    <input id="section" placeholder="Section">
    <input id="credit" type="number" placeholder="Credit">

    <select id="inputType" onchange="toggleInputType()">
      <option value="marks">Enter Marks</option>
      <option value="grade">Select Grade</option>
    </select>

    <input id="marks" type="number" placeholder="Marks">

    <select id="gradeSelect" style="display:none">
      <option value="">Select Grade</option>
      <option value="A">A</option>
      <option value="A-">A-</option>
      <option value="B+">B+</option>
      <option value="B">B</option>
      <option value="B-">B-</option>
      <option value="C+">C+</option>
      <option value="C">C</option>
      <option value="C-">C-</option>
      <option value="D+">D+</option>
      <option value="D">D</option>
      <option value="F">F</option>
    </select>

    <button onclick="saveCourse()">Save</button>
    <button onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("nsuData")) || {
  semesters: [],
  prevCGPA: []
};
let currentSem = null;

/* NSU OFFICIAL GRADING */
function gradeFromMarks(m){
  if (m >= 93) return ["A", 4.0];
  if (m >= 90) return ["A-", 3.7];
  if (m >= 87) return ["B+", 3.3];
  if (m >= 83) return ["B", 3.0];
  if (m >= 80) return ["B-", 2.7];
  if (m >= 77) return ["C+", 2.3];
  if (m >= 73) return ["C", 2.0];
  if (m >= 70) return ["C-", 1.7];
  if (m >= 67) return ["D+", 1.3];
  if (m >= 60) return ["D", 1.0];
  return ["F", 0.0];
}

function gradePointFromGrade(g){
  const map = {
    "A":4.0,"A-":3.7,"B+":3.3,"B":3.0,"B-":2.7,
    "C+":2.3,"C":2.0,"C-":1.7,"D+":1.3,"D":1.0,"F":0.0
  };
  return map[g];
}

function addSemester(){
  let name = prompt("Semester Name (e.g. Spring 2025)");
  if(!name) return;
  data.semesters.push({name, courses: [], gpa: 0});
  save();
}

function deleteSemester(i){
  if(confirm("Delete this semester?")){
    data.semesters.splice(i,1);
    save();
  }
}

function addPreviousCGPA(){
  let cg = prompt("Previous CGPA");
  let cr = prompt("Total Credits");
  if(!cg || !cr) return;
  data.prevCGPA.push({cgpa:+cg, credits:+cr});
  save();
}

function openModal(i){
  currentSem = i;
  document.getElementById("courseModal").style.display = "block";
}

function closeModal(){
  document.getElementById("courseModal").style.display = "none";
}

function toggleInputType(){
  if(inputType.value === "marks"){
    marks.style.display = "block";
    gradeSelect.style.display = "none";
  } else {
    marks.style.display = "none";
    gradeSelect.style.display = "block";
  }
}

function saveCourse(){
  let grade, point, marksValue = null;

  if(inputType.value === "marks"){
    marksValue = +marks.value;
    [grade, point] = gradeFromMarks(marksValue);
  } else {
    grade = gradeSelect.value;
    if(!grade) return alert("Select a grade");
    point = gradePointFromGrade(grade);
  }

  data.semesters[currentSem].courses.push({
    course: cCode.value,
    faculty: fCode.value,
    section: section.value,
    credit: +credit.value,
    marks: marksValue ?? "-",
    grade,
    point
  });

  closeModal();
  save();
}

function deleteCourse(si, ci){
  if(confirm("Delete this course?")){
    data.semesters[si].courses.splice(ci,1);
    save();
  }
}

function calculate(){
  let totalPoints = 0, totalCredits = 0;

  data.prevCGPA.forEach(p=>{
    totalPoints += p.cgpa * p.credits;
    totalCredits += p.credits;
  });

  data.semesters.forEach(s=>{
    let sp=0, sc=0;
    s.courses.forEach(c=>{
      sp += c.point * c.credit;
      sc += c.credit;
    });
    s.gpa = sc ? sp/sc : 0;
    totalPoints += sp;
    totalCredits += sc;
  });

  totalCGPA.innerText = totalCredits
    ? (totalPoints / totalCredits).toFixed(2)
    : "0.00";
}

function render(){
  semesters.innerHTML = "";
  data.semesters.forEach((s,i)=>{
    semesters.innerHTML += `
    <div class="sem-box">
      <h3>${s.name} | GPA: ${s.gpa.toFixed(2)}</h3>
      <button onclick="openModal(${i})">Add Course</button>
      <button class="delete-btn" onclick="deleteSemester(${i})">Delete Semester</button>

      <table>
        <tr>
          <th>Course</th><th>Faculty</th><th>Sec</th>
          <th>Credit</th><th>Marks</th><th>Grade</th><th>Delete</th>
        </tr>
        ${s.courses.map((c,j)=>`
          <tr>
            <td>${c.course}</td>
            <td>${c.faculty}</td>
            <td>${c.section}</td>
            <td>${c.credit}</td>
            <td>${c.marks}</td>
            <td>${c.grade}</td>
            <td>
              <button class="delete-btn" onclick="deleteCourse(${i},${j})">❌</button>
            </td>
          </tr>
        `).join("")}
      </table>
    </div>`;
  });
  calculate();
}

function save(){
  localStorage.setItem("nsuData", JSON.stringify(data));
  render();
}

render();
</script>

</body>
</html>
