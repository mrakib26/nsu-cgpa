<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NSU CGPA Calculator</title>
<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
.container{max-width:1100px;margin:auto;background:#fff;padding:20px;border-radius:8px}
button{padding:6px 10px;margin:2px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
.sem-box{border:1px solid #ddd;padding:12px;margin-top:15px}
.delete{background:#e74c3c;color:#fff;border:none}
.edit{background:#3498db;color:#fff;border:none}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4)}
.modal-content{background:#fff;width:360px;margin:70px auto;padding:20px;border-radius:6px}
input,select{width:100%;padding:6px;margin-bottom:8px}
</style>
</head>

<body>
<div class="container">
<h2>NSU CGPA Calculator</h2>
<button onclick="addSemester()">Add Semester</button>
<button onclick="addPreviousCGPA()">Add Previous CGPA</button>
<button onclick="downloadPDF()">Download Transcript (PDF)</button>

<h3>Total CGPA: <span id="totalCGPA">0.00</span></h3>
<div id="semesters"></div>
</div>

<div class="modal" id="modal">
<div class="modal-content">
<h3 id="modalTitle">Add Course</h3>
<input id="cCode" placeholder="Course Code">
<input id="fCode" placeholder="Faculty Code">
<input id="section" placeholder="Section">
<input id="credit" type="number" placeholder="Credit">

<select id="inputType" onchange="toggleInput()">
<option value="marks">Enter Marks</option>
<option value="grade">Select Grade</option>
</select>

<input id="marks" type="number" placeholder="Marks">

<select id="gradeSelect" style="display:none">
<option value="">Select Grade</option>
<option>A</option><option>A-</option><option>B+</option><option>B</option>
<option>B-</option><option>C+</option><option>C</option><option>C-</option>
<option>D+</option><option>D</option><option>F</option>
<option>I</option><option>W</option><option>R</option>
</select>

<button onclick="saveCourse()">Save</button>
<button onclick="closeModal()">Cancel</button>
</div>
</div>

<script>
let data=JSON.parse(localStorage.getItem("nsuData"))||{semesters:[],prevCGPA:[]}
let curSem=null,editIndex=null

function gradeFromMarks(m){
if(m>=93)return["A",4]
if(m>=90)return["A-",3.7]
if(m>=87)return["B+",3.3]
if(m>=83)return["B",3]
if(m>=80)return["B-",2.7]
if(m>=77)return["C+",2.3]
if(m>=73)return["C",2]
if(m>=70)return["C-",1.7]
if(m>=67)return["D+",1.3]
if(m>=60)return["D",1]
return["F",0]
}
function gradePoint(g){
return{A:4,"A-":3.7,"B+":3.3,B:3,"B-":2.7,"C+":2.3,C:2,"C-":1.7,"D+":1.3,D:1,F:0}[g]??0
}

function addSemester(){
let n=prompt("Semester name"); if(!n)return
data.semesters.push({name:n,courses:[],gpa:0}); save()
}
function addPreviousCGPA(){
let cg=prompt("CGPA"),cr=prompt("Credits"); if(!cg||!cr)return
data.prevCGPA.push({cgpa:+cg,credits:+cr}); save()
}

function openModal(s,i=null){
curSem=s; editIndex=i
modal.style.display="block"
modalTitle.innerText=i===null?"Add Course":"Edit Course"
if(i!==null){
let c=data.semesters[s].courses[i]
cCode.value=c.course; fCode.value=c.faculty
section.value=c.section; credit.value=c.credit
gradeSelect.value=c.grade
marks.value=c.marks!=="-"?c.marks:""
}
}
function closeModal(){modal.style.display="none";editIndex=null}

function toggleInput(){
marks.style.display=inputType.value=="marks"?"block":"none"
gradeSelect.style.display=inputType.value=="grade"?"block":"none"
}

function saveCourse(){
let grade,point,marksVal="-"
if(inputType.value=="marks"){
marksVal=+marks.value; [grade,point]=gradeFromMarks(marksVal)
}else{
grade=gradeSelect.value
if(["I","W","R"].includes(grade)) point=0
else point=gradePoint(grade)
}
let course={course:cCode.value,faculty:fCode.value,section:section.value,
credit:+credit.value,marks:marksVal,grade,point}
let arr=data.semesters[curSem].courses
editIndex===null?arr.push(course):arr[editIndex]=course
closeModal(); save()
}

function deleteCourse(s,i){if(confirm("Delete course?")){data.semesters[s].courses.splice(i,1);save()}}
function deleteSemester(i){if(confirm("Delete semester?")){data.semesters.splice(i,1);save()}}

function calc(){
let tp=0,tc=0
data.prevCGPA.forEach(p=>{tp+=p.cgpa*p.credits;tc+=p.credits})
data.semesters.forEach(s=>{
let sp=0,sc=0
s.courses.forEach(c=>{
if(["I","W","R"].includes(c.grade))return
sp+=c.point*c.credit; sc+=c.credit
})
s.gpa=sc?sp/sc:0; tp+=sp; tc+=sc
})
totalCGPA.innerText=tc?(tp/tc).toFixed(2):"0.00"
}

function render(){
semesters.innerHTML=""
data.semesters.forEach((s,i)=>{
semesters.innerHTML+=`
<div class="sem-box">
<h3>${s.name} | GPA: ${s.gpa.toFixed(2)}</h3>
<button onclick="openModal(${i})">Add Course</button>
<button class="delete" onclick="deleteSemester(${i})">Delete Semester</button>
<table>
<tr><th>Course</th><th>Faculty</th><th>Sec</th><th>Cr</th><th>Marks</th><th>Grade</th><th>Edit</th><th>Del</th></tr>
${s.courses.map((c,j)=>`
<tr>
<td>${c.course}</td><td>${c.faculty}</td><td>${c.section}</td>
<td>${c.credit}</td><td>${c.marks}</td><td>${c.grade}</td>
<td><button class="edit" onclick="openModal(${i},${j})">✏️</button></td>
<td><button class="delete" onclick="deleteCourse(${i},${j})">❌</button></td>
</tr>`).join("")}
</table>
</div>`})
calc()
}

function save(){localStorage.setItem("nsuData",JSON.stringify(data));render()}
function downloadPDF(){window.print()}
render()
</script>
</body>
</html>
